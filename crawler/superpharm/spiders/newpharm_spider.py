import scrapy
import urlparse

class NewpharmSpider(scrapy.Spider):
    name = 'newpharm'
    start_urls = ['http://prices.new-pharm.co.il/']

    REQUEST_BODY_BASE = '__VIEWSTATE=Dntk0891nsNU7WlAMlMO31eOWv5cUDyXf9%2B472Bln0454pzJgZTInHiCfXxV%2BZXlXgrnau7AHtpGvBW9io5CgeFn4behQbltIL5Oq9%2BogvpsZ2WRKJIgDTV6oyaeo3RGPwUSFnNyuYc%2FECW659w8qTP8y13CK66v5%2FIwp%2B84dr79mIwPoDsp7jwPI5O%2BwwtlkkJTEfFWVVHzczw5CtW8YkwdSeJSM6t4YPtCWaCCAgI6aGWCtoUwO%2FLpw1BNLeNm3jDVq6DDkEIk5b64y8A2cm7E%2Bcj0TJMsXM3jBECU%2BoeN8%2FUAAyYDz%2FtQsJXR1yt5mEUNMAI8IzwinMjnkVwKofn%2FsK5mMhutniC%2Fl5lwfH6Eaxw6lNoAxAP2XCTI%2FwuUxd4L%2BZIU5O%2B8SsDpEXX6YRw9G4mgHq98aJfOcwjMdj7B9hIZreZ9nbdV72NwlWKDs5WJ5fc8kFTNGl3O8LeFf7dZiMyn2b6WaD9ERHYGDK3F%2BCUudcV9lyTfqnfS0EYrFm%2F8DdslLrdgVyuL1jyUFBJjwfSZ95ArxY450CGpQSDz3cim4kWfIKBQ40j1NQ1xJHyUOzfHhiFc6i1lLUarqqDtGJasY4m0z3T9mAHuA%2FKJ%2B6gX5GGEm8bCm5QlejTilLqcS93qwf1OUBKiBXlSLKuNGMYlzZc%2BZQWE3HRhL%2FkczcYVHITrvwGiPy%2FUt7gbhv9cQJeWclS%2BVW1R6lbGPKpLQ6cK%2BVA2OM6x%2BT17Qq8CXVSnCEmjlL0IIfL8Flu3dk8P64JIvNof6LtbgLOgKOuqdTgIbY5deLv%2BD3UFv9%2BFj%2BKOhWVVBFHrhKwjoM2tgJZyBOhAib3qn9neS9OgdQieo396UWBZ3FM%2FQIY%2FVAaFjjofRI5eqa0rCLW0bLkHF0Pcn7gNVpi1%2BE%2FDzzXx1ECvAdXoIx5kNUOMq4yopuK9ydAVIb2v3Zx5nyrFQKMIENPeD%2FYjCOQO%2Fbx%2BjNhVbp7e42rI5YCfQiJqgVKnQgN6Z4BArrPnCsPAj%2FxLR%2B0oiZ1vxDDGZCaS1bK1gFPYtde6MQmdcJYrzMQQbNvsWEOWRsK6plall71AtefzUkU2YYWKE4L9euI%2FK6DYMH8gAMpw223HhZToGHkLirJEKL7kR%2F3xUusLbWsxtlSQ1ue%2FZMLoslGmixXcpA4uFh2mTl%2BFHE06czdHXhWKUBFG4jVv4VHfCASf6%2FV8OzAVDk3wqflMm6lJy5G62ACuCNsvWoQ8RyFw87rjrorE4dG3mMch2DDxZIlto2iNHhnJjbKlU5JmG5m5RoUq4alH%2Bd3x6xl0QCpC7dAhrzwXbpNerHUp51XNv%2Bkf2kMy9hbZ5FU1yeQPN%2FWs%2BqkRCaiLXYFt1z8tg560O4dXiQ4RiXjhxn3CsFM8%2FvYPowTylsi%2FjBULfw4UR%2FrORXfsJ8ryV%2FzmBgXBTqaxpadhGnU01cACddtE2T%2B8bt%2F2WoOiBubsYdw6pQmryUbJjn6IXFPEeqRpCTLMLJrSs3lMJYlVZ13z4VOUShaO4eGF3n%2BmtadWQmNsQ2LFQ9fzBQEUM%2FHXWCzXGptUcL7A7IM1JmqebZK3zhH%2FEaTBc3Q2qcRX98ZwDiC9zyFS7JJAdLYav2PEGhP1%2BsmNn3Vrdc0H5khlj2E8WKyiRaWErTMhErpz8P2LsWeJksByRHEPw99Ci8y9zcpjWZXj1Ev0jEJj79%2FkKwajuc9Rf9%2FDNa7J9RqLIs2Am8kYp%2B1WoMspoZCjQbBJK%2FWs5D69bFevEv7pls6dRp15EUzuw%2B%2Buw3fHw5rDBTXSKpMNPcdEoKi5p8NJSC7m23OjdzC%2F97dxVlrA3VbBCKWAdW0p1Kcy4qb8EEp0CpWB6%2B5Xi71%2FDj0yA5s1pt5h1matCvoq5jy%2F%2FddjyBhYfVeuwzWLftWJBxyBhSHmtK%2FSzUWcuMlxODmmOAwVwcxml%2BxBw8jcxTmPiQP2kb4Z714%2FONXuYaGLy693H0PLKiXCNZ6BeI%2FwZXlJBsQEbQkVN4RxbLqRTDVQMharuVVfgQAcnijo36qd9uuCQVA9%2BT%2F%2F55vfL10qqYcFvHQmvg3YB701Y7mEVeylrJU25Ltmb5UCU%2F5vZ2R3QifWF%2B3k6LUJdFDDo6pUQocKAp%2Fpa5q9N7YlwHoJbeONDUnf9WjtcNsg88Enk06oJg3BDxczvIJH6jPHgqg9JV%2Fqds42PkdidGTS1j2HPdohvVHsYS%2Fzvtw0z2fiViiYuCbrn6MIbCAJ4QohlTwFMivy8fEZ6wAx34xgHv%2BzDKSEz%2FIDCIuAJ9Ehoi%2BIgneYq4e4gnAItefwzONbvQoFeiMq9CkABKs9LbaF6qjFOpLo0Vw4fv52VosGO3jL4sSWeAeSurATgS05gjSe0X8NMLs5YbDO%2FYoL4gUPnTDee8SN1Q3wX7OIHebSZ6P%2BR%2FDG3IJ2IevppdQVkRIl0TaEs682m141SMbAV2bFuetE%2FMLzlp0FNHPrDsHPxxvMSvWWS4Eq%2Bejcalp1Cz%2FkEgUPwp6qzlhDX1zDJpOnXB7J1lpRWyz9EB95MFgESIXMMdRSfuIovNncvMXcPJGZS9bAJlPFp4bPoWAZtkl170DLmzCjGNhQ7aO0lLfH2EGaMjjnmXYamJXE7R8PUmpFW2NbiBljtCqnzDiUbUZeQbXyEYd1jZNH4PqtCNBDGUUo6XvJx4N28llp%2FAKS1PNf6NImaspJrzNuEk8gVSDelhzJTz3Ud3I8StEZpUnSbpIFO7eHcQ9DD4VvElww4ldcSQvtafnkcTXXZDGsxLX0vian8ytE1DaLeBX3cdjLjsOjCaC1Axr5%2B9QK3UxUDKjZfHajk6BoTQN%2F%2FbUSD52KZaCXsfpOknxocCWKq%2BiQ3ebGNu8X29sG2Qj3tEMOxb7E9fDKlr0HjbXGLB%2BFbtplLvvnHVInlJLI8ZviSqyfWzDzP1B%2B%2Bey9BYssjsFtyfWnRbwX5TM3Gm1yqhqDH2iIf1i2vZKF7wDdzQIR%2FZyahj9Wl8CHM9AWCV0Sj3HKC%2BNr%2F4aOtjHOHlRoX6NHWutkrHRXwYnvKxMqi6JlpCHeoTcXrY4CJh4oofPzXx9X3m4sLhZ4v0W7UfCpHw%2BnZksnzpBInmm4Rr4pBFIONJYN0NM%2FaowZlg36xhbf7JLTHBpIExKWHlkQNV%2BggG7nbpJzTOWRnd4gkF2EqVkrTS69gwHkxb7cc1Kt7X0eI5L5WfO9iPPyH1dS37WX8JIS5WiZ%2FJpHClzDK8R6LOZUqgOF7x605tI0i1GqL%2Fgerz4fkJ386Akeha449Oa9l45JosaInJaPf9kxsl2Eq1k6WEy17JPjeyYW35Eu72%2Bsla0qif29cO1SZ%2BWEq79ztPiNynZMSGBkCrZ5UcJKM6c5HLeZ1mKa7SvE0bXBziRTv6CHJhYOLJKT0JJHQ9MUg%2Bw7KVXOGOHKSmIL%2B%2BIn%2FqA%2Bhtm5%2FtHQ23xzkpB5Qi5DlEqDftJf9mMtaYN0VeY1GxgnlJod8ovIatmQjNDzpepmrbMq7GwOtj50I1rmh8emmgli7Rex6u8c2XGNa%2FgESIQz4SOVcWzJel%2FW6He2ZMNqF54Un0lA5B5kLk3D9hCqG1fy40N6nXUBExrh4K8%2Bl0kJDLlZzOd06YJVwlBau%2BC%2FeObtLgM65MGyLJh7TbzBAnSTv%2BWcUNtuA%2FRV2BbzVBb%2BSP%2FE3qSC5sagSEsk6QmJi5azVScljy%2FOE2XsItBTNTQk83eQGAZoXVco2%2FL%2FcXA8VpQBPzQmDFng2FDM7u6xZtjpCfzMKKA3%2B7nG1PduBOlLnpd%2FpePN9AjnE%2Bj%2FteRFGvyKRPJANCT7TFsHmKU88KkgfflgoGTHnekvFsP7R7qBchEaEBKEQwAWcVZZMlQ8Nb%2FmcyMlLqF020cje3GkhdcTVWnIPw7Zsl7KRNgYAcrMDju%2BZGWYh5TXzidsTI7zWnr7BSDMq0WsTriNX05cP2%2FPF7kUjZuA3sEo6ajDOAUXDu8BVFmfKOQiGr2HnFchY1sXG3eROFG3oXMI7UkB8uN2kJfWhxHR9bpoqz4mku8naXtegXWVtl4lYjxpuqeFFroHmd3fl2i9ADJba22m1zMJ5kCcH3iO%2BdiaLHmWIHgAKfFx7gMnkCPEtwKmTuler%2BgQ%2BGOWRvhoU1fZ123bu54%2BSi%2BSsCEPXpRN%2BbCCVk7t8E37lvqhdZ6b%2Bhyx2nA%2FiYC3pGVkG%2FMBPMpmLFwn40sW4UA8bPJkfKzq3cEhR6X33CZkl%2FVlMM3RPq8DWWY8WqpB2mQ%2B0BIJYEcO%2F4XkHw6aVZ1YzU%2FHguq%2BEb2yKfQ%2FehFcqW7UhKG0LxUPGNe6sEVRk410Z8mp0gHc4iQuGt80G%2FYyxXUkZrUdld4M7S5WFOIIwk8y7D8Ws%2FXGmhj2PAXjfzDNt25XUkUpfc3cThh0p84ynyyV9QT69SSq6%2FznSmUJVFjqozUprlOiMnriMW3lSHLxiYqm8ug2WpI5IybDxmfU5%2By8yLDntSeHmIjw%2BxanJKZUqkRPEDj30VqrIiDrkfLoDS6HR%2BGkwulS5XOuJGQEJKuRpw8Pbbrwn3V5BW4DxwCZ%2BNq4bkX7TRsfoX5V4AwWJOKoKoptAlUfSkQ6MxOmVQSLYS7wKdU4CkBIBkxrm1XgK2KZ089%2FuQC9bylAaLMlUJ2Ku8xubHd3CP%2BRT1GLgPG7luk2TgN%2FUo7VbNfSxHzFhpqXDKWsHEbLRcZKSfBgmo%2BFu1XJiVqOH70CvQdmFC6i8h8%2BjWZc4XYRT2iWIWe2c1w4bgaGsBrY09XyqrpG4pDK4HrmVaUkqBUhQCid3tTZ8nsLEeIfOiSypCdBrFMc8cTTue1XshsAAqFYDMZk1E5nIBqGvS28vMcVmyd77hGnFEmnvDCYGIiFaTqCI6vDNl%2F%2BT2qeeEUJbWm5YWFGI5MeedHKOd1%2BsY3QlJiGsDF8vKzhga9%2BZkOiAMfdod%2Fj%2B%2Bs6eCTzRedMV09OFfFXrPtpdOE4uv1M17SWvkUN6jBc%2BaX1Bs29xjhNOeRoYeEqXVeefoy%2BScfsQCaEC0pA3gdP9WQicna7cmO8TqvOI7r1nmLbISSLBEfqTqiPqBOMN9Fg9mUz406iAus9sbNFoMTxAC19PZLOqjaNGIqsPbFA7iirFh3p1UVS5l7kzI5X5MjCU5JnT9YTDFDzK2chY5oHNqx02GjXdHJJUabt28hOtGrMJGsTU3ay4r7lTY3m%2FqtXabjS9FoajcSIOzQRcaAo4DNrLF1X9TtWD%2F4eRn87FvXSJBH%2FuKdcY5qVMiW2w0OzCKBmShYWgI7tydpl72o%2B3YXJGBNUigSs5Ir%2Fx66OTu%2B4DWhE0aHaP%2BsJjtAVWs4aLDNq9g7jYvXu0tiBkWIdMHvZOEkm14zT5Zc1qSxumi1k4luaoxVeVjReBV%2BXOYIDzxn6PaoEjb8x6%2BWX7Z0wMByutdNwshfVj5pCAeXXJEzFSAd%2BrZNzcgaQpavCmqYuJBGDQlXzyfWneR9ctVNqwNLiIbJ%2FSGXNsxDkQywAzwNRQ4bWBc7APrfkxQ9HXjGAaTwlRWBcTNWB6fbJ3qilxmFlJqSuJxUOyKzJhqNW3knmiHMx5ScUXEDA9aavIOUgPT11cuB%2BjFO%2B8%2F3%2FjVORUbXTi4SM%2BPkILyJKY3c4CCJv9sdtAAUei836fkjdoz4Eciu1fCShTFuWucoBYXjjTt%2F08B9B%2FLCbtrdY9nmLG%2B8Fu5Yi9PrzeYXiNuaEFKcRFjeT9sPy9LZwl8yMbAg0y0HO4JcUTSQovVx2BH6EMNz3M%2BWSubA%2BZVnLRHEGdg6bZKdKPSvfBFocpG5oIjkko9Tp0t3ut4UfyQ2QhYebBB1cU4e22GCiNgT%2F8paJzhnlELKnT%2B7ONutyPCsb7zjNzzzxnJE0SBEcltwi9O72lG10UHM%2FUBlKQR%2FVurLUuEkxoxlKEC0oLG0yprertI%2Fc1WR%2BS5gpS%2BwWxn1WUrCK%2Bmmyo0nrDsInU7vJRcEISa4Qa6eGAoWjdLGEdgow%2Fe%2Fqx6oC3%2F2B4KrAmhj3zwVtz%2F3cL3iNWhyCgj69oAJP3n4sqSQism%2FPkSQEjqd6aFJDb1IVNRD%2BbxtpeuQ6ADdZXn40HsGLKdIknY67LWAZNk1SxdYlpIhB2jRH2%2B1K6zlCYOVMzDyPCE0V2%2FBdG3q9P5VN%2FpMO7iFNudN6mavun2tWaYT6v3J5AKJGGopIHhGfBK1yGRPfjPx%2BRI7rM9d0YXUs50laqwVqagWTh4Xd9TMjcH%2Bbyx7Pyj2gRAt6ZypcH8pu9W2aSykBx49umRCXVrn1goXV68gaZ%2BiZKBdhrY3Gi6H9a1q1MLvIIW4VMntDnthx22lBvqcpnBCfV3A6KjPnhB9x5PaBHD%2FdpkM32k6nzCC1UHpKQL3v3%2B4twz9Wqm71mlALPWLlr6rBZiCpot8G4ZsxtgDUY3ZKvwtXlEneytuXAPai%2BSg%2FDEa1%2Bemcw09biVOKzkuKmgxuS2RwLPSCehPITICXUSUrKWB59GLbOcsxDGjcbyXhgwAZ2qzK59CJ10ISoqcQZIWac7uHKpu8TTY8rTXeI2g6nf3uFVKMzdVCLKg8b9lKLSWlWN5Oz%2B0PiEWpe68b07SNFM5N6nqbm32CUu0C9GNcVj%2F9JJPn0dKJD9i6wRMj275AtO%2B138vTNDq2UZ%2FZSrERqhOyGR5qpsXdR8KoL6gFYE1siPzOH36WHS%2Fm%2Fw%2FwvXnC6tuVYwKBf5UdfDyUZeZvZekevdahBdrAiyumLe5N5jAcmM3%2BUVpILXpjGyU0MDQgR5V%2FdH3tLjyKw1z9UVYlgTktWgQg1waz79jwKrAK5bTSzqHgIKDzIZNlMKk5f34%2FaTyoB4Fp%2FefxjmGfy%2FDSjYdLMQbfIULdHWlVUCtnsB9Jj01JmKR07VUFZQa1MXiBkCPgmFFCBZGd%2FBbjT%2FbFJ6lu52hBgxN2aguDMXzKvMDEnu1W%2BKpBmmg49BSZg32hQIGiuvhHaKb16Dsupmcd5PoW4ebARuR1Q%2FTxdiO26nLY4PRX84hHp92g8RNjvKTmgPOuMzcg1YOxATSc4X8MBVXhnUoqRBvWGy4LSsdOgygGI1whrqeomiqYJRuT2G0wtzBhwC2wJuLuV5iVy1z%2F53Ym3ZCLI73L7FsVEY13HFPx3cIGBHrxBY4LrvJzBW4ncnbH%2BCDeqJLQNgg9NrAzoGmlwMtMoOfmjszJgTXInFE%2BobInQhYS3DCK9TP50RIrkkt%2FWpV4U8LZoio0sREaRjsA9nISAOZob5a%2F707yVRH2rsYYRxIGyzx1wWFKhdYVAsHhrgGxzzFqe2rzuSFWeJHUb8qE1gsIM2O3OEH9GZLF4G%2FWkm8Pxv6MOB0TOfjVK2D0yQmCEbniAlNhtaWPpdlJC7GleQccvRR9OnelkFZMv5hCLYB%2BawRr04sVwecy19aUPZBTB1Qzoe8FgroaxjQR6CeyyKirY7AD%2B6Jxol38p%2Bod6kdyQ2lpH63n%2FHv15LkpN0mPRpmxVDV5ePS%2BhtjMSeqYvb6F0bn9KpQ34oPKr9nuiCEjQRAP5PTxDss%2BcHESrXWwzgHSKBRg80BimImUK7a1IlIqZa4fXIe9oXw%2FJbLU6TcibFQjMQyrf0H5wrrd4IBjqTDLUG%2FPWM0Nj9bSR6XkNv%2FT4%2B3sNfdJ4mpM53SbsSROUOt12o1DfExCiPdfaiAHStl7mxuGSxYO8jFIkZVzchtXlHVaGbpv15h0PR9US0zqX2bhLHqvc3tvJUcASm3u7271fPR%2FMUi3WEhjxXHVhhbiRuhO4bQZwDhvxKpdH6JXTBCIXp%2Feuxyqu74h%2FHPKj%2ByDcxhbHFf4r65wOSKh7j7XtlOnqS%2BOP9WKAXxM31SPkUuwm%2BntiEaI0YAg19EeH6LhOQbEB4ddaL1lUyXeWQdXeZrsNgM9vMK86rIDF2BsVhySXOIqXU4869gWIG25Q%2BUhRkeFH%2BbQBG1P6%2Fp8CTeHGuzJYBu6oS%2FibG37k7%2FPKe7emzTJfwKURVnA6QmbocHwdEDAQRAj7qUTsy6Qbbw6cM1940cuDX1A26zh2NEzzTqqr9PVr2Mw%2B%2FIjZp0pbgDWj8ECZ0PrLvM9LLnzalSWvJJhaM9juj%2Fk9c4A9hhZU82lqoT7knobHWgXTYaNsWEYNxMC7k8cTn3k1a84oCDc8Xbfy3OJGkbdjcu%2B5v6jLHq6SKmYYPDOI9cU4IyduYWxYyQKcgtE2OnVCeIqh5it1wjas%2Fu2i%2F6LfqLirxo85pGW0Zenp9Z3vHRK%2Fcll2OVCy4CnSDIlG7V771y6AGawwJexY7AQMIknar6vG%2FJ6K8uDUJzVZDtlg16dtsNpIx4MrfwP%2B9ytX1a70vezlF1YJ79St%2BdRpKSNX9mSN0cZR9G87G1LVuYGxsZWElk0IR8HxspSmjeFhldBJ6xr82ycQ0Q8E%2Fw0GiFTQQnV6GmK0QfGoy%2FXXF8dlBjdfIItTXg5sWBaNsiCtG7cJ%2B9SjSAWk%2F9%2FbsJPgT8YHCQgGiJsvU9V899ReTLUElaR%2B5sU8j5FhXd0I6lo5%2F1%2FcCRVkov3NMd7kFCh%2FIF0VFT4lmPwkJSMm9od4lVI6po35EFncvQkxYr531FB8fIcl374rX9JQ7D50771%2BoaCSR6Fh1gdywYURGKGjj0mr%2BQeF1MOCmLbYrniaUm7w2WmTyUVLJhq%2Bwg2E0tRGIJKKRqWLxZUUYk5nAukzEqq2HdrcRWAE7OY7OvsHzR8zaePP7U9e6atx4kFbA48apoJdCU3EasUd5IiXqkTaxxzNBg2Sjo6Ui4QaJLRf7j0CWKH9mnwsi5Kef3etVE7Jikyq6Inf8KkMa5vd9yUIBTFcaussyM9%2F19FVbZ5mTo5Ky3Da6JGgom9cCFWTXDZ74uNXLZ12rbZU4sFt16LsnNWwH3JzB5GhqU6CmY%2Fk5Uxs%2F2LRVdYQk%2Bx%2BfqilnXbffbl8w%2BmyGWP0ptYW7ZDQ1Gi%2BjU7NF8%2FxaCW%2FvdZDZwa1rJytocYm78mDv%2BwnXQ5%2B4vobMhTvGw1HZy1%2FZTK5%2FdXlSnod%2FNA7FUR%2FH1p2Xg3Yt5Al0LHNSV0HVWd9dTfCPsTlfdLxe9s2KZmpYd0Iyboa62EV0ga7eQSt8TrLTk42%2BOm7rhrF74RMhZbB%2F2zDFp3G38dYSzhy9huhO2tlKOWZWb1B5TjiHyxClH1KeltCLdtvxfIEU5PLUiQbQIB4h1QODe6VoUcA6GCYSE8Ru%2FtCYW5f4rmydLJ1lM5jpgm7mU3uX35j2KT1JBe0jtQFj1p%2BtmxmbjeWSN3q1ug3nVsKcpdP8L2fmuh94cOpdUgg2CIKDLxFLWdYZwNuYcdXyrfF7XMdUlTY2%2FpQxwgNSYK6Bwo%2F59hTmvKYqXVb6YrIH1fGV2nZx4UiucRxmfKmeew9Ku%2FM9kTsf3ygqZ2rtZ7H1X0P5GoCwmMRXfBXuLeCGNTx7VNonEKYuWMelKp%2Bbs3Ql88Kn6liBP2YIcCIYweQhjm8%2Fn3CWJsFBpOY3PgpO3SiqrmJ%2Bq2LCLr0FiGKHSX3aSMLYvfBFOo9WPs75PC%2Feyx9poQ%2FikvVVkPjK1QTEiYnso13ZIJa9Ii0Gq86P0x7ngJ1arcO5niWPRbJdt0WuvJ4NJxgUKp6OYy5gHmgvGQA1akijvyLyvLtjqKpHV%2BagKMsB3OOuzcqQY6aVijsmAuqbgBfVwCI0Q5jaYlEdYey8sPUsoRgU0Pc8nK%2Fxb7UDmLQb0tvP%2BPT35ScFEcvwMEkcvYO3rMQ%2FV0O87DX0uOhA12XuTutgFee4aOG4WSZanuV5afef2fBt1jMb7A3jgFl90rqkc5r%2FRvxNJUq4Gmyrie5UPLBrSip6vV%2FTNCR69GuZKdiUtgzWRAAsjLk28FmRakbQigz%2FXh9fJF8%2F%2BiRoPFh8klKu7%2Fwr8WkxIA52UsmQrgNxcl8I%2BTKEk%2BQtP3xoWafy8X9zkkg6LeqQvCCq4IFtzZ1B2kDxSWDm7MbD8p1WlW9jqnPoP0hy%2BSMDkjwXZ8ZKz%2FOeiOkGsu%2BCQVNtR345TIKQVU67KBTfZUSGcobTwHaGTjkIf9DsahB7Eh%2BLZZ%2BebtH4tJY98PDxnuUT8CxL6qY698UtpfuVfXkHJOVg%2B4hvnTLJecoQ18Cz1ue5TUEEIAwf9DEBAke3ft3f%2Bbd3ICGD%2F2CVrD&__VIEWSTATEGENERATOR=CA0B0334&__EVENTVALIDATION=VYQl%2Fb25%2F9BPbp5nLQRhZbsawfNB7TMSKfOiU6DIXXZUknlQtde8eGtKgdV3iRrSV6QCocb0OyHCXZaGk3zWGUa4MERWi8fqFn1%2BXF79xRyyKKi3goDl27RmYOqWWQVqJ7cALmdteK1fuV9GPozj2O8IJ9fcJeNPfAuwJJjeBwKg8rFTIk4udlgw35Ms%2ByYqZGm98nM2GG5p4IigeYjD4QFayv1o2ACB4lMjnASQfYiPq0R6%2BOP380n8VSEIHz%2F0xkopbQc431FNBZxOyGPiNs68QBPfZK4L1YnGBNa04zFTdRclpylXA1v41jOgHQnq74tpqTGwJzp3UACvyUcX4ct6MdcQdKwtOFgApB3bIWlEzMdztoQ%2FsfqWbJpXkmpNBGy%2FfFGII2JmxI1iBQLmrHl9pVgvPOILrcsqlbTCaUr3DWWm6iVwdiApzdznDbnCoiO93az7Q8N8vdzsFD1pFhRx8IbXsUo1z3kdMNxxn9o2tl9Nqbhxsg77FN4ZGSfe5Z81MHUPCj81QQ41F7rFUwVYRyyj2K%2B4oPSQBwwl8uPCRPxHHhZYZCevxspyu5oC%2Fumebz3I%2FaHFmSwuPeXgZY1DNWNMeFcht3KopeYr7ocXA1VwX2IE7QHzpnxcYiAfW0ibZLswvrnzqqd8xNctV5xWqDEGOE69sUedkOW%2F53aOy2gzqYDhwxYw8ZE%2By1EL4Jgm9AQ%2Fhims8Y%2FbHhPHKxeJis0gkjNR43nP6LCIxIH2G%2FcoV276KhUEXhDzDevJCXllHkIUhMRXtSfwiY3gSsKOMj6WYXBpqT14g1xUmwaoRbgt1Ka7auL7FlOVBL9edZBilZqRZFiusSRAAwarTit6m5XqzBU39vUC4v4hyCNAjYv715Ktyxqz%2FdKJ4Kam80zI%2FNcJIW5qlcrnOZNOa4bwVFmy9vp55DVYzRKJffhZPshe0eQ40J4eQRf8Mu28jmyyktCiZCC6OW5uqHNd9jpkyXJEnCVg5F%2FEatEQHZ416QQT7jANeoa7A%2FTIU0%2FiIImEv0ZgLQvbp1MVOkfDw3KVythB8f3k05JFOWWwD%2BrstL7qSn%2BUTp%2B7QhGh5pX6qqn7vumV%2BstdUqEoG21IBc4pDBezSMOCYm0sWMWvxf7taVHHCsJF21nGvrk5H7NzBkb6l9WUhyOSOWJiDWFHx5N10CiJRl87H4wO6pkebDkX5QhFf7zMtFgDqyLYO9E%2FqC6q7d1Tb1HRYxga%2FjRJuU1kNkbG5%2BCy%2Bxi6Zai2NpGefjMy%2FXXifFyH9YIcQowgcANFGwJ2EO7FPhuNij5llgFAKTfdY0Bg1fQaaR6x3JGmjH4IhjrPFHLtub7U2DZAuV7O1yt7V%2B95Z1wQEtZNJjUPrXl4uU%2B7GWmeOBFOKcOtdBQgaW4NdGOQiEhXoxBLoVuZjhJg3b3YsNpFEtUeWJukBox%2BzRZDHDk8HLweLCHLGN6WJaCqinhO%2FGqAihn%2Bwlspol8VVKSsKwIZ1OGPQZ9c%2BsCtzd%2FAbEbYOVhT1%2FuyIUOUi3lklt8zOyM%2BkmdAm80YTihXD3qFIY%2Bi%2FIFxwORbeycPav5XapaAwl31R4sq%2B0x9uiqkrdsof1YfZHBPPmzrOc%2B7Sw8u5klO%2FAU4%2F6VZnTo9XQBF0OgOhlz8L3BQLRtO3CmxT1omRQBgpQJ3dl9xqVNBk25UKBhml3Gdi7ERDqOOjt4W84f78r8j7ImsgfbeuyPN6IoXxh5dkgl53Y1jQT0vMz7WplLjtJvM3QuqbaYfR3n%2FYlGr3FKYe0v0mERmUUHn8TaG6RGBjseIBUfVvzfQ5fuwx7kRifopLxVQ6GmyKgekbVgutA9t92vXeKnmpnXwrYOyWNk9o%2BKaJHZ2B3mTONW9NHuHFVULhALnSRHmfvliR%2BOhbWRs0kR14ojboeyVF8WT7XZo%2FAY16xRB6brCLtcJBHqFUC%2BwRMlsCHGrE%2BM6dlhiua1eUSfpbr58H9JZOGXYKCWW6nQE0sn7dUZLZeukcbvsmpj69UW4BpcPRZpwg2NXi7fYs%2BnLI4AhNuzi3%2FiiiZNMyOvH&' \
                   'ctl00%24ContentPlaceHolder1%24ddlFilter={filter}&' \
                   'ctl00%24ContentPlaceHolder1%24ddlBranches=0&'
    PAGER_REQUEST_BODY = REQUEST_BODY_BASE + 'ctl00$ContentPlaceHolder1$pager$ctl01$ctl0{prev_page}={page}'
    SEARCH_REQUEST_BODY = REQUEST_BODY_BASE + 'ctl00%24ContentPlaceHolder1%24btnSearch=%D7%97%D7%A4%D7%A9%21'

    FILTERS = {
        'PromosFull': 3,
        'PricesFull': 5,
        'Stores': 6
    }

    def parse(self, response):
        for type, filter in NewpharmSpider.FILTERS.iteritems():
            request = scrapy.Request(url=response.url,
                           method='POST',
                           headers={'Content-Type': 'application/x-www-form-urlencoded'},
                           body=NewpharmSpider.SEARCH_REQUEST_BODY.format(filter=filter),
                           callback=self.parse_search,
                           meta={'type': type, 'filter': filter})
            yield request

    def parse_search(self, response):
        for l in self.parse_download_links(response):
            yield l
        buttons = response.xpath("//input[starts-with(@name, 'ctl00$ContentPlaceHolder1$pager$ctl01$ctl')]/@value")
        for button in buttons:
            request = scrapy.Request(url=response.url,
                           method='POST',
                           headers={'Content-Type': 'application/x-www-form-urlencoded'},
                           body=NewpharmSpider.PAGER_REQUEST_BODY.format(filter=response.meta['filter'],
                                                                         prev_page=int(button.extract()) - 1,
                                                                         page=int(button.extract())),
                           callback=self.parse_download_links,
                           meta=response.meta)
            yield request
        self.logger.info("Buttons " + str([b.extract() for b in buttons]))

    def parse_download_links(self, response):
        links = response.xpath("//a[@href]")
        self.logger.info("Num urls for {} = {}".format(response.meta['type'], len(links)))
        for link in links:
            name = link.xpath("../..//span[starts-with(@id, 'ContentPlaceHolder1_lstFiles_Label1')]/text()").extract_first().lower()
            if 'pricefull' in name or 'promofull' in name or 'store' in name:
                yield {'file_urls': [urlparse.urljoin(response.url, link.xpath('@href').extract_first())],
                       'name': name,
                       'store': 'NewPharm'}